{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/flask-restful/","result":{"data":{"site":{"siteMetadata":{"title":"Sabrina S. Santos","author":"johnywalves","siteUrl":"https://SabrinaSS.com"}},"markdownRemark":{"frontmatter":{"date":"10 de setembro de 2018","created":"2018-09-10 20:33:15 -0300","title":"Web API Python com Flask, Restful e Token","description":"Um pequeno servidor em Python, com uma camada simples de segurança","category":"Python","tags":["Flask","Web","API"],"extras":null,"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAcWglhFH/8QAGBAAAwEBAAAAAAAAAAAAAAAAAQIDACH/2gAIAQEAAQUCHXtMKN//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAXEAEAAwAAAAAAAAAAAAAAAAABABAh/9oACAEBAAY/AgZlf//EABkQAQACAwAAAAAAAAAAAAAAABEAARAhQf/aAAgBAQABPyFdhZHVTeP/2gAMAwEAAgADAAAAEAfP/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAx/9oACAEDAQE/EDGf/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAh/9oACAECAQE/EHEJ/8QAGBABAQEBAQAAAAAAAAAAAAAAAREAIXH/2gAIAQEAAT8Qh+AofdBwMhVZu7//2Q=="},"images":{"fallback":{"src":"/static/388546d7494a66b8a57f1c6a70b99c36/c62f0/flask-1.jpg","srcSet":"/static/388546d7494a66b8a57f1c6a70b99c36/86eb0/flask-1.jpg 300w,\n/static/388546d7494a66b8a57f1c6a70b99c36/a06fe/flask-1.jpg 600w,\n/static/388546d7494a66b8a57f1c6a70b99c36/c62f0/flask-1.jpg 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/388546d7494a66b8a57f1c6a70b99c36/cf267/flask-1.webp 300w,\n/static/388546d7494a66b8a57f1c6a70b99c36/540ab/flask-1.webp 600w,\n/static/388546d7494a66b8a57f1c6a70b99c36/3d0d9/flask-1.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}},"html":"<p>A vantagem de utilizar uma Web API para garantir o acesso e manipulação de dados de uma aplicação possibilita controlar a disponibilidade, segurança e formato dos dados<br>\nFazendo uso de alguns pacotes Python para controlar as Requisições/Respostas, JSON, REST, JWT e Criptografia Hash podemos entregar de maneira fácil e rápida essa API</p>\n<h2>Ambiente</h2>\n<p>Usando um ambiente virtual para facilitar o controle de dependências do projeto, detalhamento disponível em <a href=\"../Virtual_Environment\">Virtual Environment</a></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> pipenv</code></pre></div>\n<p>Iniciar o ambiente virtual, onde o desenvolvimento será isolado, para gerenciar as dependências<br>\nDentro da pasta do projeto onde os fontes serão criados</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pipenv shell</code></pre></div>\n<p>Dentro do <em>pipenv</em>, os comandos ignoram os pacotes no ambiente externo, sendo necessário instalar os que serão utilizados</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pipenv <span class=\"token function\">install</span> flask flask-restful flask-jwt-extended passlib</code></pre></div>\n<h2>Flask</h2>\n<p>O pacote do <strong>Flask</strong> possibilita escutar uma porta para garantir uma aplicação <em>Web</em><br>\nCriar um arquivo <strong>app.py</strong> com o conteúdo abaixo, esse nome é um dos padrões do Flask, aconselhável seu uso</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask\n\napp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'Uma resposta flask'</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    port <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"PORT\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span> port<span class=\"token operator\">=</span>port<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Como pode ser visto ele está importando a biblioteca <strong>Flask</strong>, escutando a porta 5000 e retornando o texto 'Uma resposta flask'<br>\nAssim podemos executar o aplicativo com o comando</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">flask run</code></pre></div>\n<p>Acessando pelo navegador o endereço <a href=\"http://localhost:5000/\">http://localhost:5000/</a> vai aparecer a mensagem \"Uma resposta flask\" mostrando que o ambiente está completamente funcional</p>\n<h2>REST</h2>\n<p>De forma simplicitada uma REST faz referência a um CRUD através de requisições HTTP, onde o servidor e cliente possui uma comunicação completa sem a necessidade de armazenar informações</p>\n<ul>\n<li><strong>POST:</strong> Inserir uma ou várias instâncias</li>\n<li><strong>GET:</strong> Consultar instâncias</li>\n<li><strong>PUT:</strong> Atualizar as informações de uma ou várias instâncias</li>\n<li><strong>DELETE:</strong> Deletar uma instância</li>\n</ul>\n<p>Aplicando a leitura das requisições dos HTTP</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> flask_restful <span class=\"token keyword\">import</span> Resource<span class=\"token punctuation\">,</span> Api\n\napi <span class=\"token operator\">=</span> Api<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">response</span><span class=\"token punctuation\">(</span>Resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de POST'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de GET'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'put'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de PUT'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'delete'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de DELETE'</span><span class=\"token punctuation\">}</span>\n\napi<span class=\"token punctuation\">.</span>add_resource<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">,</span> <span class=\"token string\">'/response'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Atualizar a execução do sistema podemos verificar a resposta do processo novo</p>\n<h2>Testando</h2>\n<p>Para testar a execução podemos utiliza o <a href=\"https://www.getpostman.com/\">PostMan</a> ou pelo pacote <strong>request</strong> do Python, que pode ser instalada pelo PyPi com o comando</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> requests</code></pre></div>\n<p>Através do shell do Python, comando <em>python</em> no shell, carregamos os objetos para cada tipo de requisição</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> requests <span class=\"token keyword\">import</span> put<span class=\"token punctuation\">,</span> get<span class=\"token punctuation\">,</span> post<span class=\"token punctuation\">,</span> delete</code></pre></div>\n<p>No trecho abaixo realizamos as requisições informando a URL completa, com a função <em>.json()</em> forçando uma resposta em json</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">post<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/response'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'post':'Resposta de POST'}</span>\n\nput<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/response'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'post':'Resposta de PUT'}</span>\n\nget<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/response'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'get':'Resposta de GET'}</span>\n\ndelete<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/response'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'delete':'Resposta de DELETE'}</span></code></pre></div>\n<h2>JSON</h2>\n<p>Uma notação de objetos projetada para o JavaScript, por sua facilitada foi a adotada largamente para armazenamento e trafego de documentos estruturados e sem esquemas, por exemplo um trecho de uma receita de bolo</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'name'</span><span class=\"token operator\">:</span><span class=\"token string\">'cake'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'categories'</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'name'</span><span class=\"token operator\">:</span><span class=\"token string\">'sweet'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'name'</span><span class=\"token operator\">:</span><span class=\"token string\">'wheat'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string-property property\">'steps'</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'ingredient'</span><span class=\"token operator\">:</span><span class=\"token string\">'sugar'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span><span class=\"token string-property property\">'ingredient'</span><span class=\"token operator\">:</span><span class=\"token string\">'flour'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Usando o Flask podemos ler os dados contidos no corpo do JSON e imprimir no servidor</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> request\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">readJSON</span><span class=\"token punctuation\">(</span>Resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        data <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>json\n\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Name: '</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'First Category: '</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'categories'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Steps'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> step <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'steps'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Ingredient: '</span> <span class=\"token operator\">+</span> step<span class=\"token punctuation\">[</span><span class=\"token string\">'ingredient'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\napi<span class=\"token punctuation\">.</span>add_resource<span class=\"token punctuation\">(</span>readJSON<span class=\"token punctuation\">,</span> <span class=\"token string\">'/readjson'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Realizando um teste pela biblioteca <em>request</em>, fazendo um post informando o conteúdo através do parâmetro <em>json</em> e visualizando a impressão na parte do servidor</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">post<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/readjson'</span><span class=\"token punctuation\">,</span> json<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'cake'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'categories'</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'sweet'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'wheat'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'steps'</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token string\">'ingredient'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'sugar'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'ingredient'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'flour'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># Print do lado da aplicação</span>\n<span class=\"token comment\"># Name: cake</span>\n<span class=\"token comment\"># First Category: sweet</span>\n<span class=\"token comment\"># Steps</span>\n<span class=\"token comment\"># Ingredient: sugar</span>\n<span class=\"token comment\"># Ingredient: flour</span></code></pre></div>\n<h2>Token</h2>\n<p>Na definição de <strong>token</strong> temos símbolo, marca ou sinal, uma maneira de garantir um acesso a algo ao mostrar<br>\nPodemos limitar o acesso de algumas áreas da API exigindo a apresentação de um token, esse podendo ser concedido somente em certos aspectos por exemplo com o uso de um usuário e senha<br>\nNo trecho abaixo importamos o pacote <strong>flask_jwt_extended</strong> do <strong>jwt_extended</strong> e com <code class=\"language-text\">@jwt_required</code> limitamos o acesso ao método POST</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> flask_jwt_extended <span class=\"token keyword\">import</span> jwt_required\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">response</span><span class=\"token punctuation\">(</span>Resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token decorator annotation punctuation\">@jwt_required</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de POST'</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Como resultado ao realizar a requisição POST sem o token, o sistema bloqueia com o erro interno <em>Missing Authorization Header</em> e retornando para o cliente <em>Internal Server Error</em></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">post<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/v1.0/posts'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'message': 'Internal Server Error'}</span></code></pre></div>\n<p>Para disponibilizar o token usamos a chave secreta <code class=\"language-text\">&lt;Chave Secreta JWT></code>, cada sistema deve ter a sua própria<br>\nPodemos saber quem realizou a requisição usando o comando <code class=\"language-text\">get_jwt_identity()</code> para ler a identidade do usuário, mas antes precisamos gerar o token com essa identidade pelo <code class=\"language-text\">create_access_token</code></p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> flask_jwt_extended <span class=\"token keyword\">import</span> JWTManager<span class=\"token punctuation\">,</span> jwt_required<span class=\"token punctuation\">,</span> get_jwt_identity<span class=\"token punctuation\">,</span> create_access_token\n\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'JWT_SECRET_KEY'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;Chave Secreta JWT>'</span>\njwt <span class=\"token operator\">=</span> JWTManager<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">token</span><span class=\"token punctuation\">(</span>Resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        data <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>json\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">'admin'</span> <span class=\"token operator\">==</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'123'</span> <span class=\"token operator\">==</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'pass'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            current_user <span class=\"token operator\">=</span> get_jwt_identity<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            access_token <span class=\"token operator\">=</span> create_access_token<span class=\"token punctuation\">(</span>identity <span class=\"token operator\">=</span> current_user<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">:</span> access_token<span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>Com o trecho implantado, conseguimos acesso ao token com com um GET, informando o \"user\" e \"pass\" como \"admin\" e \"123\" respectivamente</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">post<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/token'</span><span class=\"token punctuation\">,</span> json<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'admin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pass'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'123'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'token': '&lt;token gerado>'}</span></code></pre></div>\n<p>A API retorna o token, uma sequência de caracteres que deve ser usada no header como uma autenticação Bearer, fazendo uso do pacote request novamente temos acesso ao POST da API</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Authorization\"</span><span class=\"token punctuation\">:</span><span class=\"token string\">\"Bearer &lt;token gerado>\"</span><span class=\"token punctuation\">}</span>\npost<span class=\"token punctuation\">(</span><span class=\"token string\">'http://localhost:5000/v1.0/posts'</span><span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># {'post':'Resposta de POST'}</span></code></pre></div>\n<h2>Criptografia Hash</h2>\n<p>No trecho anterior usamos como exemplo o usuário \"admin\" e senha \"123\", mas uma boa prática é evitar o uso de Text Plain para senhas uma ótima maneira é descaracterizar o conteúdo, com uma função hash</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> passlib<span class=\"token punctuation\">.</span><span class=\"token builtin\">hash</span> <span class=\"token keyword\">import</span> pbkdf2_sha256 <span class=\"token keyword\">as</span> sha256\nsha256<span class=\"token punctuation\">.</span><span class=\"token builtin\">hash</span><span class=\"token punctuation\">(</span><span class=\"token string\">'123'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\"># &lt;Sequência de caracteres Hash></span></code></pre></div>\n<p>Alterando a validação de usuário e senha, substituindo o retorno do da função anterior em \"&#x3C;Sequência de caracteres Hash>\"</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">'admin'</span> <span class=\"token operator\">==</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> sha256<span class=\"token punctuation\">.</span>verify<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'pass'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;Sequência de caracteres Hash>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></code></pre></div>\n<p>Claro que este trecho funciona melhor com uma base de dados consultando o nome do usuário e a senha hash armazenada</p>\n<h2>Compilando</h2>\n<p>Para facilitar o código completo gerado nas etapas anteriores que devem conter no <em>app.py</em> para rodar com o 'flask run'<br>\nNão esquecendo de alterar a <code class=\"language-text\">&lt;Chave Secreta JWT></code> para sua chave particular</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> flask <span class=\"token keyword\">import</span> Flask<span class=\"token punctuation\">,</span> request\n<span class=\"token keyword\">from</span> flask_restful <span class=\"token keyword\">import</span> Resource<span class=\"token punctuation\">,</span> Api\n<span class=\"token keyword\">from</span> flask_jwt_extended <span class=\"token keyword\">import</span> JWTManager<span class=\"token punctuation\">,</span> jwt_required<span class=\"token punctuation\">,</span> get_jwt_identity<span class=\"token punctuation\">,</span> create_access_token\n<span class=\"token keyword\">from</span> passlib<span class=\"token punctuation\">.</span><span class=\"token builtin\">hash</span> <span class=\"token keyword\">import</span> pbkdf2_sha256 <span class=\"token keyword\">as</span> sha256\n\napp <span class=\"token operator\">=</span> Flask<span class=\"token punctuation\">(</span>__name__<span class=\"token punctuation\">)</span>\napi <span class=\"token operator\">=</span> Api<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span>config<span class=\"token punctuation\">[</span><span class=\"token string\">'JWT_SECRET_KEY'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">'&lt;Chave Secreta JWT>'</span>\njwt <span class=\"token operator\">=</span> JWTManager<span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span>\n\n<span class=\"token decorator annotation punctuation\">@app<span class=\"token punctuation\">.</span>route</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token string\">'Uma resposta do flask'</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">response</span><span class=\"token punctuation\">(</span>Resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token decorator annotation punctuation\">@jwt_required</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de POST'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token decorator annotation punctuation\">@jwt_required</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">put</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'put'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de PUT'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token decorator annotation punctuation\">@jwt_required</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de GET'</span><span class=\"token punctuation\">}</span>\n\n    <span class=\"token decorator annotation punctuation\">@jwt_required</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">delete</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'delete'</span><span class=\"token punctuation\">:</span><span class=\"token string\">'Resposta de DELETE'</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">readJSON</span><span class=\"token punctuation\">(</span>Resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        data <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>json\n\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Name: '</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'First Category: '</span> <span class=\"token operator\">+</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'categories'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'steps'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> step <span class=\"token keyword\">in</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'steps'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>step<span class=\"token punctuation\">[</span><span class=\"token string\">'ingredient'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">token</span><span class=\"token punctuation\">(</span>Resource<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">post</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        data <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span>json\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">'admin'</span> <span class=\"token operator\">==</span> data<span class=\"token punctuation\">[</span><span class=\"token string\">'user'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> sha256<span class=\"token punctuation\">.</span>verify<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span><span class=\"token string\">'pass'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;Sequência de caracteres Hash>'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            current_user <span class=\"token operator\">=</span> get_jwt_identity<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            access_token <span class=\"token operator\">=</span> create_access_token<span class=\"token punctuation\">(</span>identity <span class=\"token operator\">=</span> current_user<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">:</span> access_token<span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\napi<span class=\"token punctuation\">.</span>add_resource<span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">,</span> <span class=\"token string\">'/token'</span><span class=\"token punctuation\">)</span>\napi<span class=\"token punctuation\">.</span>add_resource<span class=\"token punctuation\">(</span>readJSON<span class=\"token punctuation\">,</span> <span class=\"token string\">'/readjson'</span><span class=\"token punctuation\">)</span>\napi<span class=\"token punctuation\">.</span>add_resource<span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">,</span> <span class=\"token string\">'/response'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">'__main__'</span><span class=\"token punctuation\">:</span>\n    port <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>environ<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"PORT\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    app<span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">(</span>host<span class=\"token operator\">=</span><span class=\"token string\">'0.0.0.0'</span><span class=\"token punctuation\">,</span> port<span class=\"token operator\">=</span>port<span class=\"token punctuation\">)</span></code></pre></div>\n<h3>Referências</h3>\n<p><a href=\"http://flask.pocoo.org/docs/1.0/quickstart/\">Flask - Quickstart</a></p>\n<p><a href=\"http://flask.pocoo.org/docs/1.0/config/\">Flask - Configuration Handling</a></p>\n<p><a href=\"https://flask-restful.readthedocs.io/en/latest/quickstart.html\">Flask-RESTful - Quickstart</a></p>\n<p><a href=\"https://codeburst.io/jwt-authorization-in-flask-c63c1acf4eeb\">JWT authorization in Flask</a></p>","timeToRead":5,"excerpt":"A vantagem de utilizar uma Web API para garantir o acesso e manipulação de dados de uma aplicação possibilita controlar a disponibilidade…"}},"pageContext":{"slug":"/flask-restful/","recommendedLast":{"frontmatter":{"date":"23 de julho de 2023","title":"Animação para esqueleto de elementos","category":"CSS","description":"Usando HTML, CSS e keyframes para animação de esqueleto de elementos carregando com gradiente","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAECBP/aAAwDAQACEAMQAAABzSNNUhf/xAAXEAADAQAAAAAAAAAAAAAAAAABAiEy/9oACAEBAAEFAoEhd9f/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAARARQf/aAAgBAQAGPwK9E4//xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhMVH/2gAIAQEAAT8hqw0N8FBZj//aAAwDAQACAAMAAAAQf+//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QxH//xAAbEAEAAwEAAwAAAAAAAAAAAAABESFBADFhgf/aAAgBAQABPxAAUttKr5ykW1HIJTkPIifJvvv/2Q=="},"images":{"fallback":{"src":"/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/c62f0/skeleton-1.jpg","srcSet":"/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/86eb0/skeleton-1.jpg 300w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/a06fe/skeleton-1.jpg 600w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/c62f0/skeleton-1.jpg 1200w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/23bd6/skeleton-1.jpg 2400w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/cf267/skeleton-1.webp 300w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/540ab/skeleton-1.webp 600w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/3d0d9/skeleton-1.webp 1200w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/51c0c/skeleton-1.webp 2400w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}},"published":true},"timeToRead":1,"fields":{"slug":"/estilizacao-skeleton/"}},"recommendedCategory":{"frontmatter":{"date":"22 de março de 2023","title":"Construindo uma rede neural","category":"Python","description":"Criação de uma estrutura de rede neural do zero com Python","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMC/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQMF/9oADAMBAAIQAxAAAAGOSelQB//EABUQAQEAAAAAAAAAAAAAAAAAABBB/9oACAEBAAEFAof/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAYEAADAQEAAAAAAAAAAAAAAAAAAREhQf/aAAgBAQABPyFDbRJTh//aAAwDAQACAAMAAAAQc/8A/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABkQAQEBAQEBAAAAAAAAAAAAAAERAEEhMf/aAAgBAQABPxCkFStuGgt+p2byEE4c3//Z"},"images":{"fallback":{"src":"/static/4400c8745fd3d2ab6d1cd9b3f45d0440/c62f0/network-1.jpg","srcSet":"/static/4400c8745fd3d2ab6d1cd9b3f45d0440/86eb0/network-1.jpg 300w,\n/static/4400c8745fd3d2ab6d1cd9b3f45d0440/a06fe/network-1.jpg 600w,\n/static/4400c8745fd3d2ab6d1cd9b3f45d0440/c62f0/network-1.jpg 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/4400c8745fd3d2ab6d1cd9b3f45d0440/cf267/network-1.webp 300w,\n/static/4400c8745fd3d2ab6d1cd9b3f45d0440/540ab/network-1.webp 600w,\n/static/4400c8745fd3d2ab6d1cd9b3f45d0440/3d0d9/network-1.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}},"published":true},"timeToRead":3,"fields":{"slug":"/construindo-uma-rede-neural/"}}}},"staticQueryHashes":["1433154849","3590877595","3764592887","512065377","764694655"],"slicesMap":{}}