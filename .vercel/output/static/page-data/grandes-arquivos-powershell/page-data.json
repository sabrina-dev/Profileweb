{"componentChunkName":"component---src-templates-blog-post-jsx","path":"/grandes-arquivos-powershell/","result":{"data":{"site":{"siteMetadata":{"title":"Sabrina S. Santos","author":"johnywalves","siteUrl":"https://SabrinaSS.com"}},"markdownRemark":{"frontmatter":{"date":"06 de fevereiro de 2019","created":"2019-02-06 16:22:15 -0200","title":"Arquivos de texto grandes com PowerShell","description":"Dividir arquivos grandes para processando","category":"Windows","tags":["PowerShell","Arquivos"],"extras":null,"featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIE/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQAC/9oADAMBAAIQAxAAAAHFZloF/8QAGBABAAMBAAAAAAAAAAAAAAAAAAECESL/2gAIAQEAAQUCmzXL/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAABARIWH/2gAIAQEABj8CxXJ//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERYSFBcdH/2gAIAQEAAT8h9Bw51gbuXJ//2gAMAwEAAgADAAAAEI//AP/EABURAQEAAAAAAAAAAAAAAAAAABBB/9oACAEDAQE/EKf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQQf/aAAgBAgEBPxCH/8QAGxABAAICAwAAAAAAAAAAAAAAAQARITFBUWH/2gAIAQEAAT8QTNLYKJhgVxoHQRC81vZvyf/Z"},"images":{"fallback":{"src":"/static/167722a9dba03caec1abe15ad8767a3e/c62f0/files-1.jpg","srcSet":"/static/167722a9dba03caec1abe15ad8767a3e/86eb0/files-1.jpg 300w,\n/static/167722a9dba03caec1abe15ad8767a3e/a06fe/files-1.jpg 600w,\n/static/167722a9dba03caec1abe15ad8767a3e/c62f0/files-1.jpg 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/167722a9dba03caec1abe15ad8767a3e/cf267/files-1.webp 300w,\n/static/167722a9dba03caec1abe15ad8767a3e/540ab/files-1.webp 600w,\n/static/167722a9dba03caec1abe15ad8767a3e/3d0d9/files-1.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}}},"html":"<p>Lidar com arquivos de texto extensos pode ser um pouco dificil ou demorado, mas podemos facilitar com algumas funções em PowerShell</p>\n<h2>Contar linhas</h2>\n<p>Substituir o <code class=\"language-text\">&lt;caminho do arquivo></code></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$nlines</span> = 0<span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$file</span> = <span class=\"token string\">'&lt;caminho do arquivo>'</span>\n<span class=\"token function\">gc</span> <span class=\"token variable\">$file</span> <span class=\"token operator\">-</span>read 1000 <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span> <span class=\"token punctuation\">{</span> <span class=\"token variable\">$nlines</span> <span class=\"token operator\">+=</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">.</span>Length <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token namespace\">[string]</span>::Format<span class=\"token punctuation\">(</span><span class=\"token string\">\"{0} has {1} lines\"</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$file</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$nlines</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Separar arquivos por quantidades de linhas</h2>\n<p>Separar um arquivo grande de serem processados individualmente facilita o processo e controle do progresso<br>\nSubstituindo o <code class=\"language-text\">&lt;caminho do arquivo></code> e a <code class=\"language-text\">&lt;quantidade de linhas></code> o código gera <code class=\"language-text\">out_&lt;número>.txt</code> até o fim do texto</p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$i</span>=0<span class=\"token punctuation\">;</span> <span class=\"token function\">Get-Content</span> <span class=\"token string\">'&lt;caminho do arquivo>'</span> <span class=\"token operator\">-</span>ReadCount &lt;quantidade de linhas> <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span><span class=\"token variable\">$i</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$_</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-File</span> out_<span class=\"token variable\">$i</span><span class=\"token punctuation\">.</span>txt<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Na nossa língua temos vários caracteres diferentes e acentos, temos de usar um encode para evitar problemas, no exemplo estou usando o UTF8, mas temos as opções de <strong>ASCII</strong>, <strong>BigEndianUnicode</strong>, <strong>OEM</strong>, <strong>String</strong>, <strong>Unicode</strong>, <strong>UTF7</strong>, <strong>UTF8</strong>, <strong>UTF8BOM</strong>, <strong>UF8NoBOM</strong>, <strong>UTF32</strong> e <strong>Unknown</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$i</span>=0<span class=\"token punctuation\">;</span> <span class=\"token function\">Get-Content</span> <span class=\"token string\">'&lt;caminho do arquivo>'</span> <span class=\"token operator\">-</span>Encoding <span class=\"token string\">\"UTF8\"</span> <span class=\"token operator\">-</span>ReadCount &lt;quantidade de linhas> <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span><span class=\"token variable\">$i</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$_</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-File</span> <span class=\"token operator\">-</span>Encoding <span class=\"token string\">\"UTF8\"</span> out_<span class=\"token variable\">$i</span><span class=\"token punctuation\">.</span>csv<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Adicionar cabeçalho para os arquivos</h2>\n<p>Trabalhando banco de dados em arquivos de texto devemos adicionar o cabeçalho para facilitar a manipulação dos arquivos<br>\nPodemos adicionar um cabeçalho fixo, com o código abaixo substituindo o <code class=\"language-text\">&lt;caminho do arquivo></code> e a <code class=\"language-text\">&lt;texto do cabeçalho></code></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$textfile</span> = <span class=\"token string\">'&lt;caminho do arquivo>'</span>\n<span class=\"token variable\">$header</span> = <span class=\"token string\">'&lt;texto do cabeçalho>'</span>\n$<span class=\"token punctuation\">(</span><span class=\"token variable\">$header</span><span class=\"token punctuation\">;</span> <span class=\"token function\">Get-Content</span> <span class=\"token variable\">$textfile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Set-Content</span> <span class=\"token variable\">$textfile</span></code></pre></div>\n<p>Podemos adicionar ou através de um arquivo contendo o cabeçalho, com o código abaixo substituindo o <code class=\"language-text\">&lt;caminho do arquivo></code> e a <code class=\"language-text\">&lt;caminho do arquivo cabeçalho></code></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$textfile</span> = <span class=\"token string\">'&lt;caminho do arquivo>'</span>\n<span class=\"token variable\">$headerfile</span> = <span class=\"token string\">'&lt;caminho do arquivo cabeçalho>'</span>\n$<span class=\"token punctuation\">(</span><span class=\"token function\">Get-Content</span> <span class=\"token variable\">$headerfile</span><span class=\"token punctuation\">;</span> <span class=\"token function\">Get-Content</span> <span class=\"token variable\">$textfile</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Set-Content</span> <span class=\"token variable\">$textfile</span></code></pre></div>\n<h2>Dividir as linhas mantendo o cabeçalho</h2>\n<p>Adicionando os controles de <code class=\"language-text\">$header = Get-Content $file -First 1</code> para capturar o cabeçalho na primeira linha e <code class=\"language-text\">$(If ($i -ne 1) {$header} Else {$null})</code> para adicionar nos arquivos além do primeiro o cabeçalho arquivo<br>\nCom o ódigo abaixo substituindo o <code class=\"language-text\">&lt;caminho do arquivo></code> e a <code class=\"language-text\">&lt;quantidade de linhas></code></p>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token variable\">$file</span> = <span class=\"token string\">'&lt;caminho do arquivo>'</span>\n<span class=\"token variable\">$qtd_lines</span> = &lt;quantidade de linhas>\n<span class=\"token variable\">$header</span> = <span class=\"token function\">Get-Content</span> <span class=\"token variable\">$file</span> <span class=\"token operator\">-</span>First 1\n<span class=\"token variable\">$i</span>=0<span class=\"token punctuation\">;</span> <span class=\"token function\">Get-Content</span> <span class=\"token variable\">$file</span> <span class=\"token operator\">-</span>Encoding <span class=\"token string\">\"UTF8\"</span> <span class=\"token operator\">-</span>ReadCount <span class=\"token variable\">$qtd_lines</span> <span class=\"token punctuation\">|</span> <span class=\"token operator\">%</span><span class=\"token punctuation\">{</span><span class=\"token variable\">$i</span><span class=\"token operator\">++</span><span class=\"token punctuation\">;</span> $<span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">(</span><span class=\"token keyword\">If</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$i</span> <span class=\"token operator\">-ne</span> 1<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span><span class=\"token variable\">$header</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">Else</span> <span class=\"token punctuation\">{</span><span class=\"token variable\">$null</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token variable\">$_</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">|</span> <span class=\"token function\">Out-File</span> <span class=\"token operator\">-</span>Encoding <span class=\"token string\">\"UTF8\"</span> out_<span class=\"token variable\">$i</span><span class=\"token punctuation\">.</span>csv<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Referências</h2>\n<p><a href=\"https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-content\">Get-Content - Microsoft</a></p>","timeToRead":2,"excerpt":"Lidar com arquivos de texto extensos pode ser um pouco dificil ou demorado, mas podemos facilitar com algumas funções em PowerShell Contar…"}},"pageContext":{"slug":"/grandes-arquivos-powershell/","recommendedLast":{"frontmatter":{"date":"23 de julho de 2023","title":"Animação para esqueleto de elementos","category":"CSS","description":"Usando HTML, CSS e keyframes para animação de esqueleto de elementos carregando com gradiente","featuredImage":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAIABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAIDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAECBP/aAAwDAQACEAMQAAABzSNNUhf/xAAXEAADAQAAAAAAAAAAAAAAAAABAiEy/9oACAEBAAEFAoEhd9f/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAYEAACAwAAAAAAAAAAAAAAAAAAARARQf/aAAgBAQAGPwK9E4//xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhMVH/2gAIAQEAAT8hqw0N8FBZj//aAAwDAQACAAMAAAAQf+//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQIBAT8QxH//xAAbEAEAAwEAAwAAAAAAAAAAAAABESFBADFhgf/aAAgBAQABPxAAUttKr5ykW1HIJTkPIifJvvv/2Q=="},"images":{"fallback":{"src":"/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/c62f0/skeleton-1.jpg","srcSet":"/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/86eb0/skeleton-1.jpg 300w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/a06fe/skeleton-1.jpg 600w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/c62f0/skeleton-1.jpg 1200w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/23bd6/skeleton-1.jpg 2400w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/cf267/skeleton-1.webp 300w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/540ab/skeleton-1.webp 600w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/3d0d9/skeleton-1.webp 1200w,\n/static/40aaa21d6d234b122ff0bd3b4ca0f9a0/51c0c/skeleton-1.webp 2400w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":500}}},"published":true},"timeToRead":1,"fields":{"slug":"/estilizacao-skeleton/"}}}},"staticQueryHashes":["1433154849","3590877595","3764592887","512065377","764694655"],"slicesMap":{}}